# Voice-to-Plan Feature Design

## Overview

Voice-to-Plan transforms spoken task descriptions into structured development plans via the Prodaktiv physical controller. Developer pushes knob, speaks intent, releases - gets a crystal clear plan with Linear tasks.

---

## The Endgame

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚     "I need to add OAuth to the backyard API with Google and GitHub"        â”‚
â”‚                                                                             â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚                              â”‚  â—‰ KNOB â”‚ â† Push & Speak                     â”‚
â”‚                              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                    â”‚
â”‚                                   â”‚                                         â”‚
â”‚                                   â–¼                                         â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚     â”‚                     GRAPHYN DESKTOP                                â”‚   â”‚
â”‚     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚     â”‚  â”‚  Prodaktiv Plugin                                              â”‚  â”‚   â”‚
â”‚     â”‚  â”‚                                                             â”‚  â”‚   â”‚
â”‚     â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚   â”‚
â”‚     â”‚  â”‚  â”‚ ðŸŽ™ï¸ Recording...                              [STOP] â”‚   â”‚  â”‚   â”‚
â”‚     â”‚  â”‚  â”‚ â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â”‚   â”‚  â”‚   â”‚
â”‚     â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚   â”‚
â”‚     â”‚  â”‚                                                             â”‚  â”‚   â”‚
â”‚     â”‚  â”‚                         â–¼                                   â”‚  â”‚   â”‚
â”‚     â”‚  â”‚                                                             â”‚  â”‚   â”‚
â”‚     â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚   â”‚
â”‚     â”‚  â”‚  â”‚ ðŸ§  Planning...                                      â”‚   â”‚  â”‚   â”‚
â”‚     â”‚  â”‚  â”‚                                                     â”‚   â”‚  â”‚   â”‚
â”‚     â”‚  â”‚  â”‚ Understanding: "Add OAuth with Google and GitHub"   â”‚   â”‚  â”‚   â”‚
â”‚     â”‚  â”‚  â”‚ Context: @backyard (Go + Encore)                    â”‚   â”‚  â”‚   â”‚
â”‚     â”‚  â”‚  â”‚ Related: FCS-245 (auth refactor)                    â”‚   â”‚  â”‚   â”‚
â”‚     â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚   â”‚
â”‚     â”‚  â”‚                                                             â”‚  â”‚   â”‚
â”‚     â”‚  â”‚                         â–¼                                   â”‚  â”‚   â”‚
â”‚     â”‚  â”‚                                                             â”‚  â”‚   â”‚
â”‚     â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚   â”‚
â”‚     â”‚  â”‚  â”‚ ðŸ“‹ PLAN READY                              [START]  â”‚   â”‚  â”‚   â”‚
â”‚     â”‚  â”‚  â”‚                                                     â”‚   â”‚  â”‚   â”‚
â”‚     â”‚  â”‚  â”‚ Theme: OAuth Integration                            â”‚   â”‚  â”‚   â”‚
â”‚     â”‚  â”‚  â”‚ Estimated: 90 min (1 focus session)                 â”‚   â”‚  â”‚   â”‚
â”‚     â”‚  â”‚  â”‚                                                     â”‚   â”‚  â”‚   â”‚
â”‚     â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚  â”‚   â”‚
â”‚     â”‚  â”‚  â”‚ â”‚ â–¡ FCS-407: Add OAuth providers config    15min  â”‚ â”‚   â”‚  â”‚   â”‚
â”‚     â”‚  â”‚  â”‚ â”‚ â–¡ FCS-408: Google OAuth callback         25min  â”‚ â”‚   â”‚  â”‚   â”‚
â”‚     â”‚  â”‚  â”‚ â”‚ â–¡ FCS-409: GitHub OAuth callback         25min  â”‚ â”‚   â”‚  â”‚   â”‚
â”‚     â”‚  â”‚  â”‚ â”‚ â–¡ FCS-410: Update auth middleware        15min  â”‚ â”‚   â”‚  â”‚   â”‚
â”‚     â”‚  â”‚  â”‚ â”‚ â–¡ FCS-411: Test OAuth flows              10min  â”‚ â”‚   â”‚  â”‚   â”‚
â”‚     â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚  â”‚   â”‚
â”‚     â”‚  â”‚  â”‚                                                     â”‚   â”‚  â”‚   â”‚
â”‚     â”‚  â”‚  â”‚ [Edit Plan]  [Add to Queue]  [Start Focus â†’]        â”‚   â”‚  â”‚   â”‚
â”‚     â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚   â”‚
â”‚     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          VOICE-TO-PLAN ARCHITECTURE                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                            â”‚
â”‚  â”‚   ESP32      â”‚                                                            â”‚
â”‚  â”‚   KNOB       â”‚                                                            â”‚
â”‚  â”‚              â”‚                                                            â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     BLE (0x4C53)      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  â”‚ Button â”‚â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚  GRAPHYN DESKTOP               â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     VOICE_START       â”‚                                â”‚  â”‚
â”‚  â”‚              â”‚     VOICE_STOP        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                       â”‚  â”‚  Prodaktiv Plugin           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ E-Ink  â”‚â—„â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚Display â”‚  â”‚     State Updates     â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                       â”‚  â”‚  â”‚ VoiceCaptureView   â”‚  â”‚  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚  â”‚  â”‚ - Mic input        â”‚  â”‚  â”‚  â”‚
â”‚                                         â”‚  â”‚  â”‚ - Waveform viz     â”‚  â”‚  â”‚  â”‚
â”‚                                         â”‚  â”‚  â”‚ - Recording state  â”‚  â”‚  â”‚  â”‚
â”‚                                         â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚                                         â”‚  â”‚            â”‚             â”‚  â”‚  â”‚
â”‚                                         â”‚  â”‚            â–¼             â”‚  â”‚  â”‚
â”‚                                         â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
â”‚                                         â”‚  â”‚  â”‚ Whisper (local)    â”‚  â”‚  â”‚  â”‚
â”‚                                         â”‚  â”‚  â”‚ Speech-to-Text     â”‚  â”‚  â”‚  â”‚
â”‚                                         â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚                                         â”‚  â”‚            â”‚             â”‚  â”‚  â”‚
â”‚                                         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚                                         â”‚               â”‚                â”‚  â”‚
â”‚                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚                   â”‚
â”‚                                                         â–¼                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                         GRAPHYN AGENT SYSTEM                          â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ Letta Agent     â”‚    â”‚ Linear MCP      â”‚    â”‚ Graphyn-Base KB â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ Memory Blocks:  â”‚    â”‚ Tools:          â”‚    â”‚ Context:        â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ - developer     â”‚â—„â”€â”€â–ºâ”‚ - list_issues   â”‚â—„â”€â”€â–ºâ”‚ - Codebase      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ - projects      â”‚    â”‚ - create_issue  â”‚    â”‚ - Framework docsâ”‚   â”‚   â”‚
â”‚  â”‚  â”‚ - preferences   â”‚    â”‚ - update_issue  â”‚    â”‚ - Past plans    â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ - past_sessions â”‚    â”‚ - get_project   â”‚    â”‚                 â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚                              â–¼                                        â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚                    PLAN GENERATION                             â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                                â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  1. Parse spoken intent                                        â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  2. Query KB for related code/docs                             â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  3. Find related Linear issues                                 â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  4. Generate task breakdown with estimates                     â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  5. Create Linear issues (draft or published)                  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  6. Return plan to plugin UI                                   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                                â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## User Flows

### Flow 1: Quick Task (Push-and-Hold)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         QUICK TASK: PUSH-AND-HOLD                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  [1] Developer pushes and HOLDS knob                                         â”‚
â”‚      â”‚                                                                       â”‚
â”‚      â”œâ”€â”€â–º ESP32 sends BLE: VOICE_START (0x10)                               â”‚
â”‚      â”‚                                                                       â”‚
â”‚      â”œâ”€â”€â–º Plugin activates laptop microphone                                 â”‚
â”‚      â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚      â”‚    â”‚ ðŸŽ™ï¸ Listening...                        â”‚                        â”‚
â”‚      â”‚    â”‚ â–“â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â”‚                        â”‚
â”‚      â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚      â”‚                                                                       â”‚
â”‚  [2] Developer speaks: "Fix the login button alignment on mobile"            â”‚
â”‚      â”‚                                                                       â”‚
â”‚  [3] Developer RELEASES knob                                                 â”‚
â”‚      â”‚                                                                       â”‚
â”‚      â”œâ”€â”€â–º ESP32 sends BLE: VOICE_STOP (0x11)                                â”‚
â”‚      â”‚                                                                       â”‚
â”‚      â”œâ”€â”€â–º Plugin stops recording, sends to Whisper                          â”‚
â”‚      â”‚                                                                       â”‚
â”‚      â”œâ”€â”€â–º STT result: "Fix the login button alignment on mobile"            â”‚
â”‚      â”‚                                                                       â”‚
â”‚      â””â”€â”€â–º Agent processes â†’ Creates single task                              â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚           â”‚ âœ“ Created: FCS-412                      â”‚                        â”‚
â”‚           â”‚   "Fix login button alignment on mobile"â”‚                        â”‚
â”‚           â”‚   Est: 15 min                           â”‚                        â”‚
â”‚           â”‚                                         â”‚                        â”‚
â”‚           â”‚   [Add to Queue]  [Start Now â†’]         â”‚                        â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Flow 2: Complex Planning (Double-Push Toggle)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      COMPLEX PLANNING: DOUBLE-PUSH TOGGLE                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  [1] Developer DOUBLE-PUSHES knob                                            â”‚
â”‚      â”‚                                                                       â”‚
â”‚      â”œâ”€â”€â–º ESP32 detects double-push pattern                                  â”‚
â”‚      â”œâ”€â”€â–º ESP32 sends BLE: VOICE_TOGGLE_START (0x12)                        â”‚
â”‚      â”‚                                                                       â”‚
â”‚      â”œâ”€â”€â–º Plugin activates mic, shows "Recording" mode                       â”‚
â”‚      â”‚    E-Ink shows: ðŸŽ™ï¸ REC                                               â”‚
â”‚      â”‚                                                                       â”‚
â”‚  [2] Developer speaks (can take their time, pause, think):                   â”‚
â”‚      â”‚                                                                       â”‚
â”‚      â”‚   "Okay so I need to refactor the authentication system.             â”‚
â”‚      â”‚    We're using Better Auth but the session handling is buggy.        â”‚
â”‚      â”‚    I want to add refresh token rotation and also fix the             â”‚
â”‚      â”‚    issue where users get logged out randomly on mobile.              â”‚
â”‚      â”‚    Oh and we should probably add rate limiting to the                â”‚
â”‚      â”‚    auth endpoints while we're at it."                                â”‚
â”‚      â”‚                                                                       â”‚
â”‚  [3] Developer PUSHES knob once (toggle off)                                 â”‚
â”‚      â”‚                                                                       â”‚
â”‚      â”œâ”€â”€â–º ESP32 sends BLE: VOICE_TOGGLE_STOP (0x13)                         â”‚
â”‚      â”‚                                                                       â”‚
â”‚      â”œâ”€â”€â–º Plugin stops recording                                             â”‚
â”‚      â”‚    E-Ink shows: â³ PLANNING                                           â”‚
â”‚      â”‚                                                                       â”‚
â”‚  [4] Agent processes complex request:                                        â”‚
â”‚      â”‚                                                                       â”‚
â”‚      â”œâ”€â”€â–º Whisper transcribes full speech                                    â”‚
â”‚      â”œâ”€â”€â–º Agent queries KB: "Better Auth", "session handling", "refresh"    â”‚
â”‚      â”œâ”€â”€â–º Agent finds related: FCS-201 (auth issues), FCS-189 (mobile)      â”‚
â”‚      â”œâ”€â”€â–º Agent creates comprehensive plan                                   â”‚
â”‚      â”‚                                                                       â”‚
â”‚      â””â”€â”€â–º Returns structured plan:                                           â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚           â”‚ ðŸ“‹ PLAN: Auth System Refactor                               â”‚    â”‚
â”‚           â”‚                                                             â”‚    â”‚
â”‚           â”‚ Theme: Session handling + security improvements             â”‚    â”‚
â”‚           â”‚ Estimated: 3 hours (2 focus sessions)                       â”‚    â”‚
â”‚           â”‚ Related: FCS-201, FCS-189                                   â”‚    â”‚
â”‚           â”‚                                                             â”‚    â”‚
â”‚           â”‚ SESSION 1 (90 min):                                         â”‚    â”‚
â”‚           â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚           â”‚ â”‚ â–¡ FCS-413: Audit current session implementation   20min â”‚ â”‚    â”‚
â”‚           â”‚ â”‚ â–¡ FCS-414: Implement refresh token rotation       35min â”‚ â”‚    â”‚
â”‚           â”‚ â”‚ â–¡ FCS-415: Fix mobile session persistence         25min â”‚ â”‚    â”‚
â”‚           â”‚ â”‚ â–¡ FCS-416: Add session refresh tests              10min â”‚ â”‚    â”‚
â”‚           â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚           â”‚                                                             â”‚    â”‚
â”‚           â”‚ SESSION 2 (90 min):                                         â”‚    â”‚
â”‚           â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚           â”‚ â”‚ â–¡ FCS-417: Add rate limiting middleware           30min â”‚ â”‚    â”‚
â”‚           â”‚ â”‚ â–¡ FCS-418: Configure rate limits per endpoint     20min â”‚ â”‚    â”‚
â”‚           â”‚ â”‚ â–¡ FCS-419: Add rate limit headers                 15min â”‚ â”‚    â”‚
â”‚           â”‚ â”‚ â–¡ FCS-420: Integration tests                      25min â”‚ â”‚    â”‚
â”‚           â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚           â”‚                                                             â”‚    â”‚
â”‚           â”‚ [Edit Plan]  [Save Draft]  [Create All â†’]                   â”‚    â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Flow 3: Conversational Refinement

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CONVERSATIONAL REFINEMENT                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  After initial plan is generated, agent can ask clarifying questions:       â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ðŸ§  Agent Question:                                                    â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚ "I found two auth-related issues in the backlog:                      â”‚   â”‚
â”‚  â”‚  - FCS-201: Session timeout too aggressive                            â”‚   â”‚
â”‚  â”‚  - FCS-189: Mobile users logged out on app background                 â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  Should I link these to your new tasks, or are these separate?"       â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  [Link them]  [Keep separate]  [ðŸŽ™ï¸ Reply with voice]                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  Developer can:                                                              â”‚
â”‚  - Click button response                                                     â”‚
â”‚  - Push knob to reply with voice                                             â”‚
â”‚                                                                              â”‚
â”‚  Thread continues until developer is satisfied with plan.                    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## BLE Protocol Extension

Add new characteristic for voice commands:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          BLE GATT EXTENSION                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Service: Prodaktiv (0x4C49)                                                    â”‚
â”‚                                                                              â”‚
â”‚  Existing Characteristics:                                                   â”‚
â”‚  â”œâ”€â”€ State      (0x4C50) - Read/Notify - Lock state, phone presence         â”‚
â”‚  â”œâ”€â”€ Command    (0x4C51) - Write       - Lock, unlock, sync                  â”‚
â”‚  â”œâ”€â”€ Timer      (0x4C52) - Read/Write  - Timer seconds, phase                â”‚
â”‚  â”‚                                                                           â”‚
â”‚  NEW Characteristic:                                                         â”‚
â”‚  â””â”€â”€ Voice      (0x4C53) - Notify      - Voice control events                â”‚
â”‚                                                                              â”‚
â”‚  Voice Events (0x4C53):                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Byte 0: Event Type                                                   â”‚    â”‚
â”‚  â”‚   0x10 = VOICE_START      (push-and-hold started)                    â”‚    â”‚
â”‚  â”‚   0x11 = VOICE_STOP       (push-and-hold released)                   â”‚    â”‚
â”‚  â”‚   0x12 = VOICE_TOGGLE_ON  (double-push, recording started)           â”‚    â”‚
â”‚  â”‚   0x13 = VOICE_TOGGLE_OFF (single push after toggle, stop recording) â”‚    â”‚
â”‚  â”‚                                                                       â”‚    â”‚
â”‚  â”‚ Byte 1: Button State                                                  â”‚    â”‚
â”‚  â”‚   0x00 = Released                                                     â”‚    â”‚
â”‚  â”‚   0x01 = Pressed                                                      â”‚    â”‚
â”‚  â”‚   0x02 = Double-pressed                                               â”‚    â”‚
â”‚  â”‚                                                                       â”‚    â”‚
â”‚  â”‚ Bytes 2-3: Hold duration (ms, little-endian) - for push-and-hold     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  Button Detection Logic (ESP32):                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                                       â”‚    â”‚
â”‚  â”‚  IDLE â”€â”€[press]â”€â”€â–º PRESSED â”€â”€[hold >200ms]â”€â”€â–º HOLDING                â”‚    â”‚
â”‚  â”‚    â”‚                  â”‚                           â”‚                   â”‚    â”‚
â”‚  â”‚    â”‚                  â”‚ [release <200ms]          â”‚ [release]         â”‚    â”‚
â”‚  â”‚    â”‚                  â–¼                           â–¼                   â”‚    â”‚
â”‚  â”‚    â”‚            WAIT_DOUBLE â”€â”€[timeout]â”€â”€â–º SINGLE_CLICK              â”‚    â”‚
â”‚  â”‚    â”‚                  â”‚                                               â”‚    â”‚
â”‚  â”‚    â”‚                  â”‚ [press <300ms]                                â”‚    â”‚
â”‚  â”‚    â”‚                  â–¼                                               â”‚    â”‚
â”‚  â”‚    â”‚            DOUBLE_CLICK â”€â”€â–º Toggle recording mode               â”‚    â”‚
â”‚  â”‚    â”‚                                                                  â”‚    â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚    â”‚
â”‚  â”‚                                                                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## File Structure

### Plugin (prodaktiv-plugin)

```
prodaktiv-plugin/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ lib.rs
â”‚   â”œâ”€â”€ plugin.rs                    # Plugin + StreamingTask
â”‚   â”œâ”€â”€ phases.rs                    # FocusPhase state machine
â”‚   â”‚
â”‚   â”œâ”€â”€ voice/                       # NEW: Voice-to-Plan
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”œâ”€â”€ capture.rs               # Audio capture from system mic
â”‚   â”‚   â”œâ”€â”€ whisper.rs               # Local Whisper STT (whisper-rs)
â”‚   â”‚   â””â”€â”€ waveform.rs              # Audio visualization data
â”‚   â”‚
â”‚   â”œâ”€â”€ planning/                    # NEW: Plan Generation
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”œâ”€â”€ agent.rs                 # Letta agent client
â”‚   â”‚   â”œâ”€â”€ parser.rs                # Intent parsing
â”‚   â”‚   â””â”€â”€ estimator.rs             # Time estimation heuristics
â”‚   â”‚
â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â”œâ”€â”€ focus_panel.rs
â”‚   â”‚   â”œâ”€â”€ task_queue.rs
â”‚   â”‚   â”œâ”€â”€ timer_display.rs
â”‚   â”‚   â”œâ”€â”€ device_status.rs
â”‚   â”‚   â”œâ”€â”€ voice_capture.rs         # NEW: Recording UI
â”‚   â”‚   â””â”€â”€ plan_review.rs           # NEW: Plan review/edit UI
â”‚   â”‚
â”‚   â”œâ”€â”€ ble/
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”œâ”€â”€ protocol.rs              # Updated with Voice characteristic
â”‚   â”‚   â””â”€â”€ scanner.rs
â”‚   â”‚
â”‚   â””â”€â”€ linear/
â”‚       â””â”€â”€ client.rs
â”‚
â”œâ”€â”€ Cargo.toml
â””â”€â”€ README.md
```

### Firmware (prodaktiv-firmware)

```
prodaktiv-firmware/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.cpp
â”‚   â”‚
â”‚   â”œâ”€â”€ ble/
â”‚   â”‚   â”œâ”€â”€ gatt_server.cpp          # Updated with Voice characteristic
â”‚   â”‚   â””â”€â”€ protocol.h               # Updated with voice events
â”‚   â”‚
â”‚   â”œâ”€â”€ input/                       # NEW: Button handling
â”‚   â”‚   â”œâ”€â”€ button.cpp               # Debounce, double-click detection
â”‚   â”‚   â””â”€â”€ button.h
â”‚   â”‚
â”‚   â”œâ”€â”€ display/
â”‚   â”‚   â”œâ”€â”€ eink_driver.cpp
â”‚   â”‚   â””â”€â”€ ui.cpp                   # Updated with voice states
â”‚   â”‚
â”‚   â””â”€â”€ ...
â”‚
â””â”€â”€ platformio.ini
```

---

## Agent Memory Schema (Letta)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         LETTA AGENT: prodaktiv-planner                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Agent ID: prodaktiv-planner-{user_id}                                          â”‚
â”‚  Type: memgpt_agent                                                          â”‚
â”‚                                                                              â”‚
â”‚  Core Memory Blocks:                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ persona:                                                              â”‚   â”‚
â”‚  â”‚   "I am a development planning assistant for Prodaktiv. I help          â”‚   â”‚
â”‚  â”‚    developers break down spoken task descriptions into structured     â”‚   â”‚
â”‚  â”‚    Linear issues with time estimates. I have context about the       â”‚   â”‚
â”‚  â”‚    Graphyn workspace and can query the knowledge base for relevant   â”‚   â”‚
â”‚  â”‚    code and documentation."                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ developer:                                                            â”‚   â”‚
â”‚  â”‚   name: "Resat"                                                       â”‚   â”‚
â”‚  â”‚   preferences:                                                        â”‚   â”‚
â”‚  â”‚     focus_duration: 90                                                â”‚   â”‚
â”‚  â”‚     break_duration: 15                                                â”‚   â”‚
â”‚  â”‚     estimation_style: "conservative"  # or "aggressive"              â”‚   â”‚
â”‚  â”‚     auto_create_issues: false         # require confirmation         â”‚   â”‚
â”‚  â”‚   active_projects:                                                    â”‚   â”‚
â”‚  â”‚     - id: "graphyn-backyard"                                          â”‚   â”‚
â”‚  â”‚       team: "FCS"                                                     â”‚   â”‚
â”‚  â”‚     - id: "graphyn-desktop"                                           â”‚   â”‚
â”‚  â”‚       team: "FCS"                                                     â”‚   â”‚
â”‚  â”‚   working_hours: "09:00-18:00 UTC+3"                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ session_context:                                                      â”‚   â”‚
â”‚  â”‚   current_repo: "graphyn-backyard"                                    â”‚   â”‚
â”‚  â”‚   current_branch: "feat/oauth-providers"                              â”‚   â”‚
â”‚  â”‚   recent_files:                                                       â”‚   â”‚
â”‚  â”‚     - "services/auth/oauth.go"                                        â”‚   â”‚
â”‚  â”‚     - "services/auth/session.go"                                      â”‚   â”‚
â”‚  â”‚   today_completed: ["FCS-401", "FCS-402"]                             â”‚   â”‚
â”‚  â”‚   today_focus_minutes: 180                                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  Tools:                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ - linear_search_issues(query, project, state)                         â”‚   â”‚
â”‚  â”‚ - linear_create_issue(title, description, estimate, project, labels)  â”‚   â”‚
â”‚  â”‚ - linear_create_subtasks(parent_id, tasks[])                          â”‚   â”‚
â”‚  â”‚ - kb_search(query, doc_type, limit)                                   â”‚   â”‚
â”‚  â”‚ - kb_get_file_context(file_path)                                      â”‚   â”‚
â”‚  â”‚ - estimate_task(description, complexity)                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  Archival Memory (searchable):                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ - Past planning sessions with outcomes                                â”‚   â”‚
â”‚  â”‚ - Estimation accuracy history (predicted vs actual)                   â”‚   â”‚
â”‚  â”‚ - Common task patterns for this developer                             â”‚   â”‚
â”‚  â”‚ - Preferred task breakdown styles                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Implementation Tasks

### Phase 1: BLE Voice Events (Firmware)

| Task | Description | Estimate |
|------|-------------|----------|
| T-035 | Add Voice characteristic (0x4C53) to GATT server | 2h |
| T-036 | Implement button double-click detection | 2h |
| T-037 | Implement push-and-hold detection with timing | 1h |
| T-038 | Update E-Ink UI for voice states (REC, PLANNING) | 2h |

### Phase 2: Voice Capture (Plugin)

| Task | Description | Estimate |
|------|-------------|----------|
| T-039 | Integrate whisper-rs for local STT | 4h |
| T-040 | Implement VoiceCaptureView GPUI component | 3h |
| T-041 | Audio waveform visualization | 2h |
| T-042 | Handle BLE voice events from controller | 2h |

### Phase 3: Planning Agent (Letta)

| Task | Description | Estimate |
|------|-------------|----------|
| T-043 | Create prodaktiv-planner agent in Letta | 3h |
| T-044 | Define memory blocks schema | 2h |
| T-045 | Implement planning tools (Linear, KB) | 4h |
| T-046 | Task breakdown and estimation logic | 4h |

### Phase 4: Plan Review UI (Plugin)

| Task | Description | Estimate |
|------|-------------|----------|
| T-047 | PlanReviewView GPUI component | 4h |
| T-048 | Edit plan inline | 2h |
| T-049 | Create Linear issues from plan | 2h |
| T-050 | Add to task queue action | 1h |

### Phase 5: Integration & Polish

| Task | Description | Estimate |
|------|-------------|----------|
| T-051 | Conversational refinement flow | 3h |
| T-052 | Voice reply support | 2h |
| T-053 | E2E testing | 4h |
| T-054 | Error handling and edge cases | 3h |

---

## Success Metrics

1. **Voice capture latency**: < 500ms from knob release to STT start
2. **STT accuracy**: > 95% for technical terms (code, APIs, frameworks)
3. **Planning quality**: Developer accepts plan without edits 70% of time
4. **Time to plan**: < 30 seconds from speech end to plan displayed
5. **Estimation accuracy**: Within 20% of actual time 80% of sessions

---

## Future Enhancements

1. **Multi-language support**: STT for non-English developers
2. **Voice shortcuts**: "Start focus", "Next task", "Take a break"
3. **Team sync**: Share plans with team members in Linear
4. **Learning**: Agent improves estimates based on actual completion times
5. **Integrations**: GitHub PR creation, Slack notifications

---

## Appendix: Whisper Model Selection

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         WHISPER MODEL COMPARISON                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Model      Size      Speed      Accuracy     Recommended For               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  tiny       75MB      ~10x RT    ~88%         NOT recommended               â”‚
â”‚  base       142MB     ~7x RT     ~92%         Quick commands only           â”‚
â”‚  small      466MB     ~4x RT     ~95%         âœ“ RECOMMENDED (default)       â”‚
â”‚  medium     1.5GB     ~2x RT     ~97%         High accuracy needs           â”‚
â”‚  large      2.9GB     ~1x RT     ~98%         Maximum accuracy              â”‚
â”‚                                                                              â”‚
â”‚  RT = Real-time (1x means transcription takes as long as audio)             â”‚
â”‚                                                                              â”‚
â”‚  Recommendation: Use "small" model by default (good balance)                â”‚
â”‚  Allow user to select in settings if they have GPU/more RAM                 â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
